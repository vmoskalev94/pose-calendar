# Фронтенд

Owner: mv_vm
Number: 50

## 1. Технологический стек фронта

Предлагаю такой набор:

- **React + TypeScript + Vite** – основа.
- **React Router** – маршрутизация (`/login`, `/app`).
- **TanStack Query (React Query)** – работа с API (fetch, кэш, loading/error), без Redux.
- **Tailwind CSS** или обычный CSS/SCSS-модули
    
    – я бы взял Tailwind, чтобы быстрее набросать layout и не тонуть в ручной верстке.
    
- **Axios** – HTTP-клиент с interceptor’ом для JWT.

Если тебе захочется UI-библиотеку (MUI/Mantine) — можно будет поверх этого прикрутить, но на старте можно и без неё.

---

## 2. Общая структура фронтенда

Предлагаю feature-based структуру, чтобы не выросли файлы по 500 строк:

`frontend/`

- `src/`
    - `app/`
        - `App.tsx` – корневой компонент
        - `router.tsx` – все маршруты
        - `providers/` – обёртки (React Query, Router, Theme)
    - `shared/`
        - `api/` – axios-инстанс, общие типы ответов
        - `config/` – базовые настройки (urls, env)
        - `ui/` – базовые UI-компоненты (Button, Input, Modal, Tabs и т.п.)
        - `types/` – общие TS-типы (User, Platform и т.п.)
        - `lib/` – хелперы (форматирование даты, утилиты календаря)
    - `features/`
        - `auth/`
            - `components/` (LoginForm)
            - `api/` (login, me)
            - `model/` (hooks: `useAuth`)
        - `packs/`
            - `components/` (`PackShortCard`, `PackDetailsModal`, `PackForm`, `PackFilesSection`, `PackChecklistSection`)
            - `api/` (`usePacksQuery`, `useCreatePackMutation`, и т.п.)
            - `model/` (типы `Pack`, `PackTask`, `PackFile`)
        - `releases/`
            - `components/` (`ReleaseCard`, `ReleaseViewModal`, `ReleaseFormModal`)
            - `api/` (`useReleasesForRangeQuery`, `useCreateReleaseMutation` и т.п.)
            - `model/` (типы `Release`, `ReleasePlatform`, `PostDraft`)
        - `calendar/`
            - `components/` (`CalendarGrid`, `CalendarDayCell`, `CalendarHeader`)
            - `lib/` (расчёт дней месяца)
    - `widgets/`
        - `layout/`
            - `AppLayout.tsx` – левый сайдбар + верхняя панель + основная область
            - `Sidebar.tsx`
            - `TopBar.tsx`
        - `calendar-page/`
            - `CalendarPageLayout.tsx` – композиция: календарь в центре + правая панель
            - `UpcomingPanel.tsx` – правая панель с табами «Паки / Релизы»
    - `pages/`
        - `LoginPage.tsx`
        - `CalendarPage.tsx`
        - `NotFoundPage.tsx`
    - `main.tsx` – входная точка Vite

Так у нас:

- нет «god-компонента», который делает всё,
- логика по фичам (auth, packs, releases, calendar),
- layout-уровень (widgets) не знает про детали работы с API.

---

## 3. Как разложим макеты по компонентам

### 3.1. Страница логина

**Route:** `/login`

**Компоненты:**

- `pages/LoginPage.tsx`
    - использует `features/auth/components/LoginForm.tsx`
- `LoginForm`:
    - поля: email, password
    - `onSubmit` → `authApi.login` → сохраняем токен → редирект на `/app`

**Логика авторизации:**

- `auth/api`:
    - `login(credentials) → Promise<{ token, user }>`
    - `getMe() → currentUser`
- `auth/model/useAuth`:
    - хранит пользователя в React Query / или в context
    - умеет `logout()`

**Защита маршрутов:**

- в `app/router.tsx` делаем `ProtectedRoute`:
    - если нет токена → редирект на `/login`;
    - если есть → рендерим `AppLayout`.

---

### 3.2. Главный layout приложения

**Route:** `/app/*`

`widgets/layout/AppLayout.tsx`:

- Левый сайдбар (`Sidebar`)
- Верхняя панель (`TopBar`) – месяц, стрелки, возможно переключатель вида позже
- Основная область:
    - центр – `CalendarPageLayout`
    - справа – `UpcomingPanel`

Примерная структура JSX:

```tsx
<AppLayout>
  <Sidebar />
  <div className="flex flex-col flex-1">
    <TopBar />
    <CalendarPageLayout />
  </div>
</AppLayout>

```

`Sidebar`:

- логотип/название (Pose Calendar)
- пункты:
    - Calendar (активный)
    - Packs (на будущее отдельная страница, если захотите)
    - Analytics (потом)
- настройки/логаут внизу.

---

### 3.3. Экран календаря (центральная часть макета)

**Компонент:** `widgets/calendar-page/CalendarPageLayout.tsx`

Состав:

- `CalendarHeader` – месяц/год + стрелки переключения.
- `div` с двумя колонками:
    - слева – `CalendarGrid` (month view),
    - справа – `UpcomingPanel` (правая панель из макета).

### `CalendarHeader`

- показывает текущий месяц/год (`December 2025`).
- кнопки:
    - «<» / «>» для смены месяца
    - возможно, today.

Внутри использует `calendar/lib` утилиты типа `getNextMonth(date)`, `getPrevMonth(date)`.

### `CalendarGrid`

- Рисует таблицу 7×N:
    - строка заголовков дней (Mon, Tue, …).
    - дальше недели месяца.
- На вход получает:
    - `currentMonth: Date`
    - `releases: Release[]` (для диапазона месяца)
    - например, коллбэки `onDayClick(date)`, `onReleaseClick(release)`.

`CalendarDayCell`:

- показывает номер дня
- список релизов дня в виде цветных бейджей (по типу/статусу)
- при клике:
    - по пустому пространству – открыть модал «создать релиз».
    - по бейджу – открыть модал «просмотр/редактировать релиз».

---

### 3.4. Правая панель — «Паки / Релизы»

**Компонент:** `widgets/calendar-page/UpcomingPanel.tsx`

Структура:

- Tabs: «Паки» / «Релизы»
- Содержимое:

**Tab "Паки"**

Компонент: `features/packs/components/PackListPanel.tsx`

- Запрашивает список паков: `usePacksQuery()` (React Query).
- Показывает компактные карточки:

`PackShortCard`:

- название
- статус (цветной бэйдж)
- возможно, маленький превью-образ (cover)
- click → открыть `PackDetailsModal`

Внизу кнопка «Создать новый пак» → открыть `PackFormModal` (создание).

**Tab "Релизы"**

Компонент: `features/releases/components/ReleaseListPanel.tsx`

- Запрашивает релизы «в ближайшие N дней» (`useUpcomingReleasesQuery()`).
- Структура:
    - заголовок релиза
    - дата/время
    - краткое описание/связанный пак
- click по карточке релиза → открыть `ReleaseViewModal`.

Мне нравится такая связка:

- правая панель — список (быстрый доступ),
- модалки — деталка/редактирование.

---

### 3.5. Модалки релизов

**1) Просмотр релиза**

`features/releases/components/ReleaseViewModal.tsx`

Поля (как на макете):

- Название релиза
- Дата + время
- Пак (кликабельно → открыть `PackDetailsModal`)
- Чекбоксы платформ (Telegram, Boosty, VK, Tumblr) + статусы.
- Кнопки:
    - Edit → `ReleaseFormModal` в режиме редактирования
    - Delete
    - Close (крестик).

**2) Создание/редактирование релиза**

`features/releases/components/ReleaseFormModal.tsx`

Форма:

- Название
- Дата (DatePicker)
- Время (TimePicker / простой select/инпут)
- Пак (Select из `usePacksQuery`)
- Платформы – чекбоксы (React state → потом отправляем как массив `Platform` или создаём `ReleasePlatform` на бэке).

Работа с API через хуки:

- `useCreateReleaseMutation`
- `useUpdateReleaseMutation`
- `useDeleteReleaseMutation`

После успешного сохранения:

- закрываем модал,
- инвалидируем `releases`кеш (React Query), чтобы календарь/список обновился.

---

### 3.6. Модалка / экран полной карточки пака

**Компонент:** `features/packs/components/PackDetailsModal.tsx`

Табличная структура внутри:

1. **Основная информация**
    - Название RU / EN
    - Тип (select)
    - Статус
    - Теги/хэштеги
    - Кол-во поз, наличие All-in-one
    - Описание
2. **Файлы**
    - `PackFilesSection`:
        - блок «Обложка» – превью + кнопка загрузки/замены
        - «Превью/скрины» – список миниатюр + добавление
        - «Архив» – кнопка загрузить/скачать
    - каждая операция → `useUploadPackFileMutation`, `useDeletePackFileMutation`
3. **Чек-лист**
    - `PackChecklistSection`:
        - список `PackTask`, галочки.
        - `onToggle(taskId)` → `useToggleTaskMutation`

По макету это модалка на весь экран, но можно сделать:

- Либо модалкой поверх календаря,
- Либо отдельной страницей `/app/packs/:id`, а из календаря переходить туда — зависит от предпочтений. Для MVP модалка удобнее.

---

### 3.7. Где хранить состояние «выбранного дня/релиза/пака»

Простой вариант:

- Внутри `CalendarPageLayout`:

```tsx
const [selectedDate, setSelectedDate] = useState<Date | null>(null);
const [selectedReleaseId, setSelectedReleaseId] = useState<string | null>(null);
const [selectedPackId, setSelectedPackId] = useState<string | null>(null);
const [isReleaseFormOpen, setReleaseFormOpen] = useState(false);
// и т.п.

```

И передаёшь эти set’еры вниз в `CalendarGrid` и `UpcomingPanel`.

Серверное состояние (списки паков/релизов/детали) — в React Query.

UI-состояние (открыт ли модал, что сейчас выбрано) — в локальном состоянии конкретной страницы. Без Redux – и будет компактно.

---

## 4. Связь с бекендом

### 4.1. Общий axios-инстанс

`shared/api/http.ts`:

- Базовый URL (например, `/api`).
- Interceptor:
    - читает JWT из `localStorage` (или из auth-context)
    - добавляет `Authorization: Bearer ...`.

### 4.2. Примеры hooks

**Паки:**

```tsx
export function usePacksQuery() {
  return useQuery({
    queryKey: ['packs'],
    queryFn: () => http.get<PackDto[]>('/packs').then(r => r.data),
  });
}

```

**Релизы за диапазон:**

```tsx
export function useReleasesForMonth(month: Date) {
  const { from, to } = getMonthRange(month);
  return useQuery({
    queryKey: ['releases', from, to],
    queryFn: () =>
      http
        .get<ReleaseDto[]>('/releases', { params: { fromDate: from, toDate: to } })
        .then(r => r.data),
  });
}

```

`CalendarPageLayout` поднимает стейт текущего месяца и дергает `useReleasesForMonth`.

---

## 5. Как будем двигаться дальше (реально)

1. **Утверждаем эту структуру** (можешь сказать: «да, ок, только Tailwind заменить на X» — легко адаптируем).
2. Следующим шагом я могу:
    - расписать **первые роуты и каркас компонентов** (что создать и в каком порядке),
    - и/или **дать черновой код** для:
        - `AppLayout`
        - `CalendarPageLayout`
        - `CalendarGrid` (с заглушкой данных)
        - `LoginPage + LoginForm`.

Чтобы ты мог уже создать Vite-проект, разложить папки и начать собирать UI по макетам.